FROM python:3.8
ARG ARG_DJANGO_SECRECT_KEY=ARG_DJANGO_SECRECT_KEY

ARG ARG_SQL_HOST=ARG_SQL_HOST
ARG ARG_SQL_PORT=ARG_SQL_PORT
ARG ARG_SQL_DATABASE=ARG_SQL_DATABASE
ARG ARG_SQL_USER=ARG_SQL_USER
ARG ARG_SQL_PASSWORD=ARG_SQL_PASSWORD

ARG ARG_AWS_ACCESS_KEY_ID=ARG_AWS_ACCESS_KEY_ID
ARG ARG_AWS_SECRET_ACCESS_KEY=ARG_AWS_SECRET_ACCESS_KEY
ARG ARG_AWS_REGION=ARG_AWS_REGION
ARG ARG_AWS_STORAGE_BUCKET_NAME=ARG_AWS_STORAGE_BUCKET_NAME

ENV PYTHONUNBUFFERED=1

ENV DJANGO_SETTINGS_MODULE="moranique.settings.prod"
ENV DJANGO_SECRECT_KEY=$ARG_DJANGO_SECRECT_KEY

ENV SQL_HOST=$ARG_SQL_HOST
ENV SQL_PORT=$ARG_SQL_PORT
ENV SQL_DATABASE=$ARG_SQL_DATABASE
ENV SQL_USER=$ARG_SQL_USER
ENV SQL_PASSWORD=$ARG_SQL_PASSWORD

ENV AWS_ACCESS_KEY_ID=$ARG_AWS_ACCESS_KEY_ID
ENV AWS_SECRET_ACCESS_KEY=$ARG_AWS_SECRET_ACCESS_KEY
ENV AWS_REGION=$ARG_AWS_REGION
ENV AWS_STORAGE_BUCKET_NAME=$ARG_AWS_STORAGE_BUCKET_NAME

WORKDIR  /usr/src/app
COPY . /usr/src/app

RUN apt-get update
RUN pip install -r requirements.txt
RUN apt-get install -y --no-install-recommends \
    gcc libgraphviz-dev default-libmysqlclient-dev

ENTRYPOINT ["gunicorn", "--bind", "0.0.0.0:8000", "moranique.wsgi:application"]